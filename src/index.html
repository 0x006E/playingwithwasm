<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
  <title>Document</title>
</head>

<body>
  <canvas id="canvas"></canvas>
  <script id="worker" type="text/javascript">

    self.onmessage = function (e) {
      cvs = e.data.canvas;
      const ctx = cvs.getContext("2d");
      canvasWidth = canvas.width;
      canvasHeight = canvas.height;
      var imageData = ctx.getImageData(0, 0, canvasWidth, canvasHeight);

      var buf = new ArrayBuffer(imageData.data.length);
      var buf8 = new Uint8ClampedArray(buf);
      var data = new Uint32Array(buf);

      // Determine whether Uint32 is little- or big-endian.
      data[1] = 0x0a0b0c0d;

      var isLittleEndian = true;
      if (buf[4] === 0x0a && buf[5] === 0x0b && buf[6] === 0x0c && buf[7] === 0x0d) {
        isLittleEndian = false;
      }

      function draw(x, y, colors = [0, 0, 0]) {
        if (isLittleEndian) {
          data[y * canvasWidth + x] =
            (255 << 24) | // alpha
            (colors[2] << 16) | // blue
            (colors[1] << 8) | // green
            colors[0]; // red
        } else {
          data[y * canvasWidth + x] =
            (colors[0] << 24) | // red
            (colors[1] << 16) | // green
            (colors[2] << 8) | // blue
            255; // alpha
        }
        imageData.data.set(buf8);
        ctx.putImageData(imageData, 0, 0);
      }

      ctx.putImageData(imageData, 0, 0);
      console.log(e.data);
      if (e.data.msg === "start") {
        for (var i = 0; i < canvasWidth; i++) {
          draw(i, i, [234, 245, 155]);
        }
        break;
      }
      else if (e.data.msg === "init") {
        for (var y = 0; y < canvasHeight; ++y) {
          for (var x = 0; x < canvasWidth; ++x) {
            draw(x, y);
          }
        }
        break;
      }
    }

  </script>
  <script src="./main.js"></script>
  </script>
</body>

</html>